---
title: 'Ant Design Vue å®ç°è¡¨å•ä¸Šä¼  Excel æ–‡ä»¶æ—¶æ ¡éªŒè¡Œæ•°'
date: '2024-07-10'
url: 'ant-design-vue-validate-row-count-on-excel-upload'
summary: 'æœ€è¿‘åœ¨å¼€å‘æ—¶é‡åˆ°è¿™æ ·çš„éœ€æ±‚ï¼šå¯¹ä¸Šä¼ çš„ Excel æ–‡ä»¶è¡Œæ•°è¿›è¡Œæ ¡éªŒï¼Œè¡Œæ•°è¶…è¿‡ 1000 åˆ™æç¤ºç”¨æˆ·æ•°æ®è¶…é™ã€‚æœ¬æ¥è¯¥æ ¡éªŒæ˜¯åœ¨ç”¨æˆ·é€‰æ‹©æ–‡ä»¶åç”±å‰ç«¯æ ¡éªŒï¼Œåç»­ä¸´æ—¶å˜æ›´ä¸ºä¸Šä¼ æ–‡ä»¶åç”±åç«¯æ ¡éªŒï¼Œä½†æ˜¯å‰ç«¯ä»£ç å·²ç»å¼€å‘å®Œæ¯•äº†ï¼Œç›´æ¥åˆ é™¤æ€ªå¯æƒœçš„ï¼Œé‚è®°å½•'
tags:
  - Vue
---

æœ€è¿‘åœ¨å¼€å‘æ—¶é‡åˆ°è¿™æ ·çš„éœ€æ±‚ï¼šå¯¹ä¸Šä¼ çš„ Excel æ–‡ä»¶è¡Œæ•°è¿›è¡Œæ ¡éªŒï¼Œè¡Œæ•°è¶…è¿‡ 1000 åˆ™æç¤ºç”¨æˆ·æ•°æ®è¶…é™ã€‚æœ¬æ¥è¯¥æ ¡éªŒæ˜¯åœ¨ç”¨æˆ·é€‰æ‹©æ–‡ä»¶åç”±å‰ç«¯æ ¡éªŒï¼Œåç»­ä¸´æ—¶å˜æ›´ä¸ºä¸Šä¼ æ–‡ä»¶åç”±åç«¯æ ¡éªŒï¼Œä½†æ˜¯å‰ç«¯ä»£ç å·²ç»å¼€å‘å®Œæ¯•äº†ï¼Œç›´æ¥åˆ é™¤æ€ªå¯æƒœçš„ï¼Œé‚è®°å½•ã€‚

## å®Œæ•´ä»£ç å®ç°

æƒ³è¦åœ¨çº¿å°è¯•å¯ä»¥ç‚¹å‡»è¿™é‡ŒğŸ‘‰ [åœ¨çº¿ä»£ç ](https://codesandbox.io/p/sandbox/ant-design-vue-shi-xian-biao-dan-shang-chuan-excel-wen-jian-shi-xiao-yan-xing-shu-j875d7?file=%2Fsrc%2FApp.vue%3A57%2C15&layout=%257B%2522sidebarPanel%2522%253A%2522EXPLORER%2522%252C%2522rootPanelGroup%2522%253A%257B%2522direction%2522%253A%2522horizontal%2522%252C%2522contentType%2522%253A%2522UNKNOWN%2522%252C%2522type%2522%253A%2522PANEL_GROUP%2522%252C%2522id%2522%253A%2522ROOT_LAYOUT%2522%252C%2522panels%2522%253A%255B%257B%2522type%2522%253A%2522PANEL_GROUP%2522%252C%2522contentType%2522%253A%2522UNKNOWN%2522%252C%2522direction%2522%253A%2522vertical%2522%252C%2522id%2522%253A%2522clyfs2m3000063b6jqecvx7iy%2522%252C%2522sizes%2522%253A%255B100%252C0%255D%252C%2522panels%2522%253A%255B%257B%2522type%2522%253A%2522PANEL_GROUP%2522%252C%2522contentType%2522%253A%2522EDITOR%2522%252C%2522direction%2522%253A%2522horizontal%2522%252C%2522id%2522%253A%2522EDITOR%2522%252C%2522panels%2522%253A%255B%257B%2522type%2522%253A%2522PANEL%2522%252C%2522contentType%2522%253A%2522EDITOR%2522%252C%2522id%2522%253A%2522clyfs2m3000023b6jcbyh4f01%2522%257D%255D%257D%252C%257B%2522type%2522%253A%2522PANEL_GROUP%2522%252C%2522contentType%2522%253A%2522SHELLS%2522%252C%2522direction%2522%253A%2522horizontal%2522%252C%2522id%2522%253A%2522SHELLS%2522%252C%2522panels%2522%253A%255B%257B%2522type%2522%253A%2522PANEL%2522%252C%2522contentType%2522%253A%2522SHELLS%2522%252C%2522id%2522%253A%2522clyfs2m3000033b6j4vhexoll%2522%257D%255D%252C%2522sizes%2522%253A%255B100%255D%257D%255D%257D%252C%257B%2522type%2522%253A%2522PANEL_GROUP%2522%252C%2522contentType%2522%253A%2522DEVTOOLS%2522%252C%2522direction%2522%253A%2522vertical%2522%252C%2522id%2522%253A%2522DEVTOOLS%2522%252C%2522panels%2522%253A%255B%257B%2522type%2522%253A%2522PANEL%2522%252C%2522contentType%2522%253A%2522DEVTOOLS%2522%252C%2522id%2522%253A%2522clyfs2m3000053b6jfhcroirh%2522%257D%255D%252C%2522sizes%2522%253A%255B100%255D%257D%255D%252C%2522sizes%2522%253A%255B50%252C50%255D%257D%252C%2522tabbedPanels%2522%253A%257B%2522clyfs2m3000023b6jcbyh4f01%2522%253A%257B%2522tabs%2522%253A%255B%257B%2522id%2522%253A%2522clyfs2m2z00013b6jhvq9zg1q%2522%252C%2522mode%2522%253A%2522permanent%2522%252C%2522type%2522%253A%2522FILE%2522%252C%2522filepath%2522%253A%2522%252Fsrc%252FApp.vue%2522%252C%2522state%2522%253A%2522IDLE%2522%252C%2522initialSelections%2522%253A%255B%257B%2522startLineNumber%2522%253A57%252C%2522startColumn%2522%253A15%252C%2522endLineNumber%2522%253A57%252C%2522endColumn%2522%253A15%257D%255D%257D%255D%252C%2522id%2522%253A%2522clyfs2m3000023b6jcbyh4f01%2522%252C%2522activeTabId%2522%253A%2522clyfs2m2z00013b6jhvq9zg1q%2522%257D%252C%2522clyfs2m3000053b6jfhcroirh%2522%253A%257B%2522id%2522%253A%2522clyfs2m3000053b6jfhcroirh%2522%252C%2522tabs%2522%253A%255B%257B%2522id%2522%253A%2522clyfs2m3000043b6jjmxnmbbc%2522%252C%2522mode%2522%253A%2522permanent%2522%252C%2522type%2522%253A%2522UNASSIGNED_PORT%2522%252C%2522port%2522%253A0%252C%2522path%2522%253A%2522%252F%2522%257D%255D%252C%2522activeTabId%2522%253A%2522clyfs2m3000043b6jjmxnmbbc%2522%257D%252C%2522clyfs2m3000033b6j4vhexoll%2522%253A%257B%2522tabs%2522%253A%255B%255D%252C%2522id%2522%253A%2522clyfs2m3000033b6j4vhexoll%2522%257D%257D%252C%2522showDevtools%2522%253Atrue%252C%2522showShells%2522%253Afalse%252C%2522showSidebar%2522%253Atrue%252C%2522sidebarPanelSize%2522%253A15%257D)

```javascript
<template>
  <div id="app">
    <a-form :form="batchImportForm">
      <!-- æ–‡ä»¶ä¸Šä¼  -->
      <a-form-item label="æ–‡ä»¶ä¸Šä¼ ">
        <a-upload
          v-decorator="['uploadFile', fileOption]"
          accept=".xlsx,.xls"
          :file-list="fileList"
          :remove="handleRemove"
          :before-upload="handleBeforeUpload"
        >
          <a-button shape="round">æ–‡ä»¶ä¸Šä¼ </a-button>
        </a-upload>
      </a-form-item>
    </a-form>
  </div>
</template>

<script>
import * as XLSX from "xlsx";

export default {
  name: "App",
  data() {
    return {
      // æ‰¹é‡å¯¼å…¥è¡¨å•
      batchImportForm: this.$form.createForm(this),
      // æ–‡ä»¶åˆ—è¡¨
      fileList: [],
    };
  },
  computed: {
    // æ–‡ä»¶ä¸Šä¼ è¡¨å•æ ¡éªŒ
    fileOption() {
      return {
        rules: [
          {
            message: "æ–‡ä»¶æ¡æ•°è¶…é™ï¼Œæœ€å¤š10æ¡",
            validator: this.isFileEntryExceed,
          },
        ],
      };
    },
  },
  methods: {
    handleRemove() {
      this.fileList = [];
    },
    handleBeforeUpload(file) {
      this.fileList = [file];
      return false;
    },
    // åˆ¤æ–­æ–‡ä»¶æ¡æ•°æ˜¯å¦è¶…é™ 10 æ¡ï¼Œè¡¨å¤´ä¸è®¡
    isFileEntryExceed(rule, value, callback) {
      const reader = new FileReader();
      reader.onload = (event) => {
        const data = new Uint8Array(event.target.result);
        const workbook = XLSX.read(data, { type: "array" });
        const firstSheetName = workbook.SheetNames[0];
        const worksheet = workbook.Sheets[firstSheetName];
        const jsonData = XLSX.utils.sheet_to_json(worksheet);
        const rowCount = jsonData.length;
        if (rowCount > 10) {
          callback(new Error(rule.message));
        }
        callback();
      };
      reader.readAsArrayBuffer(value.file);
    },
  },
};
</script>
```

## è¡Œæ•°æ ¡éªŒ

ä»¥ Excel æ–‡ä»¶çš„ç¬¬ä¸€ä¸ª Sheet é¡µä¸ºä¾‹ï¼Œä½¿ç”¨ `xlsx` åº“å°†æ–‡ä»¶è½¬æ¢ä¸º JSON æ•°æ®ï¼Œç„¶åè·å–æ•°æ®çš„é•¿åº¦å³å¯ã€‚

```javascript
// åˆ¤æ–­æ–‡ä»¶æ¡æ•°æ˜¯å¦è¶…é™ 10 æ¡ï¼Œè¡¨å¤´ä¸è®¡
function isFileEntryExceed(rule, value, callback) {
  const reader = new FileReader();
  reader.onload = (event) => {
    const data = new Uint8Array(event.target.result);

    const workbook = XLSX.read(data, { type: "array" });
    const firstSheetName = workbook.SheetNames[0];
    const worksheet = workbook.Sheets[firstSheetName];
    const jsonData = XLSX.utils.sheet_to_json(worksheet);

    const rowCount = jsonData.length;
    // éœ€è¦æ³¨æ„çš„æ˜¯è¡¨å¤´ä¸è®¡å…¥è¡Œæ•°
    if (rowCount > 10) {
      callback(new Error(rule.message));
    }
    callback();
  };

  reader.readAsArrayBuffer(value.file);
}
```

