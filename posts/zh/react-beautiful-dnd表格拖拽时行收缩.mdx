---
title: 'react-beautiful-dndè¡¨æ ¼æ‹–æ‹½æ—¶è¡Œæ”¶ç¼©'
date: '2023-12-19'
url: 'fix-react-beautiful-dnd-table-row-shrink-issue'
summary: 'æœ€è¿‘åœ¨ä½¿ç”¨react-beautiful-dndå¼€å‘è¡¨æ ¼æ‹–æ‹½æ’åºæ—¶é‡åˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼šåœ¨é€‰ä¸­ä¸€è¡Œå¹¶å¼€å§‹æ‹–æ‹½æ—¶ ï¼Œè¡Œã€æˆ–è€…è¯´å•å…ƒæ ¼çš„æ ·å¼ä¼šå‘ç”Ÿå˜åŒ–ï¼Œå…·ä½“è¡¨ç°ä¸ºæ•´è¡Œå®½åº¦æ”¶ç¼©ã€‚åœ¨æœç´¢èµ„æ–™å¹¶ç¿»é˜…æ–‡æ¡£åï¼Œæ‰¾åˆ°äº†è¿™ä¸ªé—®é¢˜çš„è§£å†³æ–¹æ³•'
tags:
  - React
  - CSS
---

æœ€è¿‘åœ¨ä½¿ç”¨react-beautiful-dndå¼€å‘è¡¨æ ¼æ‹–æ‹½æ’åºæ—¶é‡åˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼šåœ¨é€‰ä¸­ä¸€è¡Œå¹¶å¼€å§‹æ‹–æ‹½æ—¶ ï¼Œè¡Œã€æˆ–è€…è¯´å•å…ƒæ ¼çš„æ ·å¼ä¼šå‘ç”Ÿå˜åŒ–ï¼Œå…·ä½“è¡¨ç°ä¸ºæ•´è¡Œå®½åº¦æ”¶ç¼©ã€‚åœ¨æœç´¢èµ„æ–™å¹¶ç¿»é˜…æ–‡æ¡£åï¼Œæ‰¾åˆ°äº†è¿™ä¸ªé—®é¢˜çš„è§£å†³æ–¹æ³•ã€‚

å…ˆçœ‹ä¸€ä¸‹å¯¹ä¸€ä¸ªæ ‡å‡†è¡¨æ ¼çš„æŸè¡Œæ‹–æ‹½æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆå§ï¼Œå¯ä»¥çœ‹åˆ°è¢«æ‹–æ‹½è¡Œæ”¶ç¼©äº†èµ·æ¥ï¼Œè¿™å®é™…ä¸Šæ˜¯å› ä¸ºåˆ—çš„å®½åº¦ä¸¢å¤±äº†ã€‚
<Image src="https://chev.contrails.space:12650/images/2024/06/10/13276d3949a02fcdea4e3b978363bab3.png" alt="é»˜è®¤æ‹–æ‹½æ ·å¼" width={400} height={400} />

åœ¨react-beautiful-dndå®˜æ–¹æ–‡æ¡£ä¸­æåˆ°äº†åœ¨è¡¨æ ¼ä¸­ä½¿ç”¨çš„æ–¹æ³•ï¼š[Tables](https://github.com/atlassian/react-beautiful-dnd/blob/master/docs/patterns/tables.md)ã€‚å…¶ä¸­æåˆ°å¯ä»¥ä½¿ç”¨ä¸¤ç§ç­–ç•¥å¯¹è¡¨æ ¼è¿›è¡Œæ‹–æ‹½æ’åºï¼Œåˆ†åˆ«æ˜¯`Fixed layouts`å’Œ`Dimension locking`ï¼Œæ¥ä¸‹æ¥æˆ‘åˆ†åˆ«ä»‹ç»ä¸€ä¸‹ã€‚

## Fixed layouts

ç›¸æ¯”äºåè€…ï¼Œ`Fixed layouts`æ€§èƒ½æ›´å¥½ä¸”æ›´å®¹æ˜“å®ç°ï¼Œä½†æ˜¯åªé€‚ç”¨äºè¡¨æ ¼åˆ—å®½å›ºå®šçš„æƒ…å†µï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œåªéœ€è¦ä¸º`<Draggable />`åŒ…è£¹çš„è¡Œè®¾ç½®`display: table`å³å¯ã€‚

å¦‚æœä¸Šè¿°æ–¹æ³•ä¸ç”Ÿæ•ˆï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä¸º`<td>`å…ƒç´ è®¾ç½®ä¸€ä¸ªå›ºå®šå®½åº¦ï¼Œæ¯”å¦‚è¿™é‡Œå°†`<td>`å…ƒç´ çš„å®½åº¦è®¾ç½®ä¸º`120px`ï¼š
```jsx
<DragDropContext onDragEnd={this.onDragEnd}>
  <Droppable droppableId="droppable">
    {(provided, snapshot) => (
      <table
        ref={provided.innerRef}
        style={getListStyle(snapshot.isDraggingOver)}
      >
        <thead>
          <tr>
            <th>Title</th>
            <th>Test</th>
          </tr>
        </thead>
        <tbody>
          {this.state.items.map((item, index) => (
            <Draggable key={item.id} draggableId={item.id} index={index}>
              {(provided, snapshot) => (
                <tr
                  ref={provided.innerRef}
                  {...provided.draggableProps}
                  {...provided.dragHandleProps}
                  style={getItemStyle(
                    snapshot.isDragging,
                    provided.draggableProps.style
                  )}
                >
                  <td style={{ width: "120px" }}>{item.content}</td>
                  <td style={{ width: "120px" }}>{item.test}</td>
                </tr>
              )}
            </Draggable>
          ))}
          {provided.placeholder}
        </tbody>
      </table>
    )}
  </Droppable>
</DragDropContext>
```
å½“ç„¶è¿™ä¸æ˜¯æœ¬æ–‡çš„é‡ç‚¹ï¼Œæ¯•ç«Ÿä¸æ˜¯æ¯ä¸ªè¡¨æ ¼éƒ½å¯ä»¥å›ºå®šåˆ—å®½çš„ï¼Œå¾ˆå¤šæƒ…å†µä¸‹åˆ—å®½ä¼šæ ¹æ®å•å…ƒæ ¼ä¸­çš„å†…å®¹è‡ªé€‚åº”ï¼Œè¿™ç§æƒ…å†µå°±åªèƒ½ä½¿ç”¨ä¸‹é¢çš„æ–¹æ³•äº†ã€‚

## Dimension locking

å‰é¢æåˆ°è¿™ç§æ–¹æ³•é€‚ç”¨äºåˆ—å®½æ ¹æ®å†…å®¹è‡ªé€‚åº”çš„æƒ…å†µï¼Œä¸ä»…å¦‚æ­¤ï¼Œå®ƒåŒæ ·é€‚ç”¨äºåˆ—å®½å›ºå®šçš„æƒ…å†µï¼Œè€Œä¸”æ›´åŠ å…·æœ‰å¥å£®æ€§ï¼Œä½†æ˜¯æ€§èƒ½ä¼šæ¯”è¾ƒå·®ã€‚ä½¿ç”¨è¿™ç§æ–¹æ³•æ—¶è¡¨æ ¼å†…å®¹æœ€å¥½ä¸è¦è¶…è¿‡50è¡Œï¼Œå°±ç®—ä¸è€ƒè™‘æ€§èƒ½ï¼Œä¸Šç™¾è¡Œå†…å®¹çš„æ‹–æ‹½ä½“éªŒæƒ³å¿…ä¹Ÿä¸ä¼šå¾ˆå¥½ã€‚

è¿™ä¸ªæ–¹æ³•çš„å®ç°æ€è·¯ç®€å•æ¥è¯´å°±æ˜¯ï¼šåœ¨æ‹–æ‹½å‰è®°å½•è¢«æ‹–æ‹½è¡Œæ¯ä¸ªå•å…ƒæ ¼çš„åŸå§‹å®½åº¦å’Œé«˜åº¦ï¼Œå¹¶åœ¨æ‹–æ‹½ä¸­å°†è¯¥è¡Œå•å…ƒæ ¼å®½é«˜è®¾ç½®ä¸ºè®°å½•å€¼ï¼Œæ‹–æ‹½ç»“æŸåç§»é™¤æ ·å¼ã€‚
```jsx
import React, { useState, useEffect, useRef } from "react";
import { DragDropContext, Droppable, Draggable } from "react-beautiful-dnd";

class LockedCell extends React.Component {
  ref;

  getSnapshotBeforeUpdate(prevProps) {
    if (!this.ref) {
      return null;
    }

    const isDragStarting =
      this.props.isDragOccurring && !prevProps.isDragOccurring;

    if (!isDragStarting) {
      return null;
    }

    const { width, height } = this.ref.getBoundingClientRect();

    const snapshot = {
      width,
      height,
    };

    return snapshot;
  }

  componentDidUpdate(prevProps, prevState, snapshot) {
    const ref = this.ref;
    if (!ref) {
      return;
    }

    if (snapshot) {
      if (ref.style.width === snapshot.width) {
        return;
      }
      ref.style.width = `${snapshot.width}px`;
      ref.style.height = `${snapshot.height}px`;
      return;
    }

    if (this.props.isDragOccurring) {
      return;
    }

    // inline styles not applied
    if (ref.style.width == null) {
      return;
    }

    // no snapshot and drag is finished - clear the inline styles
    ref.style.removeProperty("height");
    ref.style.removeProperty("width");
  }

  setRef = (ref) => {
    this.ref = ref;
  };

  render() {
    return (
      <td ref={this.setRef} style={{ boxSizing: "border-box" }}>
        {this.props.children}
      </td>
    );
  }
}

const App = () => {
  const [items, setItems] = useState([]);
  const [isDragging, setIsDragging] = useState(false);

  // æ„é€ æµ‹è¯•æ•°æ®
  const getItems = (count) =>
    Array.from({ length: count }, (v, k) => k).map((k) => ({
      id: `item-${k}`,
      content: `Item ${k}`,
    }));
  useEffect(() => {
    setItems(getItems(3));
  }, []);

  const onDragEnd = (result) => {
    setIsDragging(false);
  };

  const onBeforeDragStart = () => {
    setIsDragging(true);
  };

  return (
    <div style={{ padding: "2rem" }}>
      <table>
        <thead>
          <tr>
            <th>Item</th>
            <th>Two</th>
            <th>Three</th>
            <th>Four</th>
          </tr>
        </thead>

        <DragDropContext
          onDragEnd={onDragEnd}
          onBeforeDragStart={onBeforeDragStart} // DIMENSION LOCKING
        >
          <Droppable droppableId="droppable">
            {(provided) => (
              <tbody {...provided.droppableProps} ref={provided.innerRef}>
                {items.map((item, index) => (
                  <Draggable key={item.id} draggableId={item.id} index={index}>
                    {(provided, snapshot) => (
                      <tr
                        ref={provided.innerRef}
                        {...provided.draggableProps}
                        {...provided.dragHandleProps}
                      >
                        <LockedCell
                          isDragOccurring={isDragging}
                          snapshot={snapshot}
                        >
                          {item.content}
                        </LockedCell>
                        <LockedCell
                          isDragOccurring={isDragging}
                          snapshot={snapshot}
                        >
                          2
                        </LockedCell>
                        <LockedCell
                          isDragOccurring={isDragging}
                          snapshot={snapshot}
                        >
                          3
                        </LockedCell>
                        <LockedCell
                          isDragOccurring={isDragging}
                          snapshot={snapshot}
                        >
                          4
                        </LockedCell>
                      </tr>
                    )}
                  </Draggable>
                ))}
                {provided.placeholder}
              </tbody>
            )}
          </Droppable>
        </DragDropContext>
      </table>
    </div>
  );
};

export default App;
```
å¯ä»¥çœ‹åˆ°æ‹–æ‹½å®¹å™¨çš„å®ç°æ²¡æœ‰ä»€ä¹ˆå˜åŒ–ï¼Œå…³é”®ç‚¹åœ¨äºä½¿ç”¨`<LockedCell>`æ›¿ä»£äº†`<td>`ï¼Œè€Œ`<LockedCell>`å…·ä½“åšäº†ä»€ä¹ˆå‘¢ï¼Ÿ

åˆšæ‰å·²ç»å¤§è‡´æè¿°è¿‡äº†ï¼Œä½¿ç”¨`onBeforeDragStart`æ£€æµ‹æ‹–æ‹½çŠ¶æ€çš„ä¸´ç•Œç‚¹ï¼Œæ‹–æ‹½å‰è®°å½•å¥½è¯¥è¡Œä¸­æ‰€æœ‰å•å…ƒæ ¼çš„å®½é«˜ï¼Œæ‹–æ‹½ä¸­è®¾ç½®å®½é«˜ä¸ºè®°å½•å€¼ï¼Œæ‹–æ‹½ç»“æŸåæ¸…é™¤æ ·å¼ã€‚è¿™ä¹Ÿæ˜¯æœ¬æ–¹æ³•æ€§èƒ½ä½çš„åŸå› ï¼Œéœ€è¦é¢‘ç¹è¯»å–DOMå…ƒç´ çš„å±æ€§å¹¶æ¸²æŸ“ã€‚

ä»£ç çš„å®ç°å¯ä»¥åœ¨è¿™é‡ŒæŸ¥çœ‹ğŸ‘‰ [åœ¨çº¿ä»£ç ](https://codesandbox.io/p/sandbox/graggable-table-5rx478?layout=%257B%2522sidebarPanel%2522%253A%2522EXPLORER%2522%252C%2522rootPanelGroup%2522%253A%257B%2522direction%2522%253A%2522horizontal%2522%252C%2522contentType%2522%253A%2522UNKNOWN%2522%252C%2522type%2522%253A%2522PANEL_GROUP%2522%252C%2522id%2522%253A%2522ROOT_LAYOUT%2522%252C%2522panels%2522%253A%255B%257B%2522type%2522%253A%2522PANEL_GROUP%2522%252C%2522contentType%2522%253A%2522UNKNOWN%2522%252C%2522direction%2522%253A%2522vertical%2522%252C%2522id%2522%253A%2522clq58j2c800063b5ufhcayw1m%2522%252C%2522sizes%2522%253A%255B100%252C0%255D%252C%2522panels%2522%253A%255B%257B%2522type%2522%253A%2522PANEL_GROUP%2522%252C%2522contentType%2522%253A%2522EDITOR%2522%252C%2522direction%2522%253A%2522horizontal%2522%252C%2522id%2522%253A%2522EDITOR%2522%252C%2522panels%2522%253A%255B%257B%2522type%2522%253A%2522PANEL%2522%252C%2522contentType%2522%253A%2522EDITOR%2522%252C%2522id%2522%253A%2522clq58j2c800023b5uv1s9nhpn%2522%257D%255D%257D%252C%257B%2522type%2522%253A%2522PANEL_GROUP%2522%252C%2522contentType%2522%253A%2522SHELLS%2522%252C%2522direction%2522%253A%2522horizontal%2522%252C%2522id%2522%253A%2522SHELLS%2522%252C%2522panels%2522%253A%255B%257B%2522type%2522%253A%2522PANEL%2522%252C%2522contentType%2522%253A%2522SHELLS%2522%252C%2522id%2522%253A%2522clq58j2c800033b5umbqvdhse%2522%257D%255D%252C%2522sizes%2522%253A%255B100%255D%257D%255D%257D%252C%257B%2522type%2522%253A%2522PANEL_GROUP%2522%252C%2522contentType%2522%253A%2522DEVTOOLS%2522%252C%2522direction%2522%253A%2522vertical%2522%252C%2522id%2522%253A%2522DEVTOOLS%2522%252C%2522panels%2522%253A%255B%257B%2522type%2522%253A%2522PANEL%2522%252C%2522contentType%2522%253A%2522DEVTOOLS%2522%252C%2522id%2522%253A%2522clq58j2c800053b5u1n9cnb7z%2522%257D%255D%252C%2522sizes%2522%253A%255B100%255D%257D%255D%252C%2522sizes%2522%253A%255B50%252C50%255D%257D%252C%2522tabbedPanels%2522%253A%257B%2522clq58j2c800023b5uv1s9nhpn%2522%253A%257B%2522id%2522%253A%2522clq58j2c800023b5uv1s9nhpn%2522%252C%2522tabs%2522%253A%255B%257B%2522id%2522%253A%2522clqdqasrf00023b5tiigrjd63%2522%252C%2522mode%2522%253A%2522permanent%2522%252C%2522type%2522%253A%2522FILE%2522%252C%2522initialSelections%2522%253A%255B%257B%2522startLineNumber%2522%253A154%252C%2522startColumn%2522%253A11%252C%2522endLineNumber%2522%253A154%252C%2522endColumn%2522%253A11%257D%255D%252C%2522filepath%2522%253A%2522%252Fsrc%252FApp.js%2522%252C%2522state%2522%253A%2522IDLE%2522%257D%255D%252C%2522activeTabId%2522%253A%2522clqdqasrf00023b5tiigrjd63%2522%257D%252C%2522clq58j2c800053b5u1n9cnb7z%2522%253A%257B%2522tabs%2522%253A%255B%257B%2522id%2522%253A%2522clq58j2c800043b5uoc5ruvzh%2522%252C%2522mode%2522%253A%2522permanent%2522%252C%2522type%2522%253A%2522UNASSIGNED_PORT%2522%252C%2522port%2522%253A0%252C%2522path%2522%253A%2522%252F%2522%257D%255D%252C%2522id%2522%253A%2522clq58j2c800053b5u1n9cnb7z%2522%252C%2522activeTabId%2522%253A%2522clq58j2c800043b5uoc5ruvzh%2522%257D%252C%2522clq58j2c800033b5umbqvdhse%2522%253A%257B%2522tabs%2522%253A%255B%255D%252C%2522id%2522%253A%2522clq58j2c800033b5umbqvdhse%2522%257D%257D%252C%2522showDevtools%2522%253Atrue%252C%2522showShells%2522%253Afalse%252C%2522showSidebar%2522%253Atrue%252C%2522sidebarPanelSize%2522%253A15%257D)ï¼Œæœ€åçœ‹ä¸€ä¸‹æ•ˆæœå§ï¼Œå¯ä»¥çœ‹åˆ°è¡Œæ‹–æ‹½è¿‡ç¨‹ä¸­å®½åº¦ä¸å†æ”¶ç¼©äº†ï¼š
<Image src="https://chev.contrails.space:12650/images/2024/06/10/d87a1ec5afb1ed3501eeeb9766f7c134.png" alt="Dimension locking" width={400} height={400} />


